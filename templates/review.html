
{% extends "layout.html" %}

{% block title %}Review Card - Anki Clone{% endblock %}

{% block content %}
<div class="card text-center mx-auto" style="max-width: 40rem;">
    <div class="card-header">
        Review Card
    </div>
    <div class="card-body">
        <div class="question">
            <h5 class="card-title">Question</h5>
            <div class="card-text fs-4 markdown-content" data-content="{{ card.question }}"></div>
        </div>
        <hr>
        <div class="answer" id="answer" style="display: none;">
             <h5 class="card-title">Answer</h5>
            <div class="card-text fs-4 markdown-content" data-content="{{ card.answer }}"></div>
        </div>
    </div>
    <div class="card-footer text-muted">
        <button class="btn btn-primary" onclick="showAnswer()">Show Answer</button>

        <form id="review-form" action="/review/{{ card.id }}" method="post" class="mt-3" style="display: none;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <button type="submit" name="status" value="remembered" class="btn btn-success">Remembered</button>
                <button type="submit" name="status" value="forgot" class="btn btn-danger">Forgot</button>
            </div>
        </form>
    </div>
</div>

<div class="card mt-4 mx-auto" style="max-width: 40rem;">
    <div class="card-header">
        Deck Status
    </div>
    <ul class="list-group list-group-flush">
        <li class="list-group-item d-flex justify-content-between align-items-center">
            Total Cards
            <span class="badge bg-primary rounded-pill">{{ total_cards }}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
            Due Today
            <span class="badge bg-warning text-dark rounded-pill">{{ due_today_count }}</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
            New Cards
            <span class="badge bg-info text-dark rounded-pill">{{ new_cards_count }}</span>
        </li>
    </ul>
</div>

{% if learning_cards %}
<div class="card mt-4 mx-auto" style="max-width: 40rem;">
    <div class="card-header">
        Cards in Learning
    </div>
    <ul class="list-group list-group-flush">
        {% for lcard in learning_cards %}
        <li class="list-group-item markdown-content" data-content="{{ lcard.question }}">
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        // Safely render all markdown content with DOMPurify
        document.querySelectorAll('.markdown-content').forEach(function(el) {
            const rawContent = el.dataset.content;
            if (rawContent) {
                el.innerHTML = window.safeMarkdown(rawContent);
            }
        });

        // After parsing, tell MathJax to typeset the new content
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
    });

    function showAnswer() {
        document.getElementById('answer').style.display = 'block';
        document.getElementById('review-form').style.display = 'block';
        document.querySelector('button[onclick="showAnswer()"]').style.display = 'none';
    }
</script>
{% endblock %}
